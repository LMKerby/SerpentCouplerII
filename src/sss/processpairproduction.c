/*****************************************************************************/
/*                                                                           */
/* serpent 2 (beta-version) : processpairproduction.c                        */
/*                                                                           */
/* Created:       2014/11/21 (TKa)                                           */
/* Last modified: 2015/05/21 (TKa)                                           */
/* Version:       2.1.24                                                     */
/*                                                                           */
/* Description: Processes pair production data                               */
/*                                                                           */
/* Comments:                                                                 */
/*                                                                           */
/*****************************************************************************/

#include "header.h"
#include "locations.h"

#define FUNCTION_NAME "ProcessPairProduction:"


/*****************************************************************************/

void ProcessPairProduction(long loc0, long nuc) {
  long i, ptr, Z;
  double a, a2, fc;
  const double Emax = 100;

  const double ppmaxdxsfitc[100][5] = {
    {15.712, 525.50, -392.40, 83.770, 339.67},
    {15.372, 501.88, -366.79, 80.706, 320.35},
    {15.147, 485.79, -351.56, 78.700, 306.82},
    {14.977, 474.16, -340.29, 77.270, 297.03},
    {14.838, 464.39, -331.35, 76.099, 288.68},
    {14.715, 454.58, -324.12, 74.962, 280.01},
    {14.615, 448.81, -317.38, 74.277, 275.19},
    {14.521, 442.35, -311.61, 73.540, 269.56},
    {14.436, 436.42, -306.43, 72.875, 264.34},
    {14.358, 430.99, -301.69, 72.274, 259.54},
    {14.285, 425.93, -297.30, 71.723, 255.06},
    {14.216, 421.15, -293.20, 71.210, 250.82},
    {14.152, 416.70, -289.35, 70.740, 246.87},
    {14.090, 412.49, -285.72, 70.302, 243.12},
    {14.031, 408.17, -282.38, 69.856, 239.22},
    {13.975, 404.43, -279.06, 69.478, 235.91},
    {13.920, 400.69, -275.94, 69.103, 232.56},
    {13.868, 397.16, -272.92, 68.755, 229.41},
    {13.818, 393.97, -269.99, 68.450, 226.59},
    {13.768, 390.54, -267.29, 68.120, 223.50},
    {13.717, 386.19, -264.76, 67.689, 219.55},
    {13.673, 384.00, -262.16, 67.503, 217.61},
    {13.627, 380.85, -259.69, 67.212, 214.79},
    {13.582, 377.80, -257.28, 66.933, 212.06},
    {13.537, 374.80, -254.91, 66.663, 209.38},
    {13.493, 371.74, -252.53, 66.386, 206.68},
    {13.450, 368.88, -250.25, 66.133, 204.14},
    {13.408, 366.20, -248.05, 65.904, 201.76},
    {13.366, 363.32, -245.78, 65.652, 199.25},
    {13.323, 360.12, -243.39, 65.361, 196.50},
    {13.273, 354.59, -240.87, 64.791, 191.76},
    {13.243, 355.34, -239.25, 64.979, 192.28},
    {13.203, 352.88, -237.15, 64.780, 190.13},
    {13.163, 350.21, -234.96, 64.556, 187.84},
    {13.122, 347.29, -232.66, 64.302, 185.39},
    {13.083, 344.83, -230.54, 64.106, 183.28},
    {13.036, 340.22, -227.68, 63.637, 179.57},
    {13.006, 340.46, -226.50, 63.780, 179.51},
    {12.968, 338.09, -224.38, 63.595, 177.50},
    {12.929, 335.75, -222.26, 63.414, 175.53},
    {12.891, 333.51, -220.16, 63.246, 173.65},
    {12.853, 331.15, -218.00, 63.063, 171.68},
    {12.816, 328.97, -215.89, 62.903, 169.86},
    {12.776, 326.23, -213.54, 62.672, 167.65},
    {12.740, 324.51, -211.58, 62.571, 166.17},
    {12.703, 322.21, -209.37, 62.394, 164.28},
    {12.666, 320.11, -207.22, 62.245, 162.56},
    {12.629, 317.93, -205.02, 62.085, 160.77},
    {12.591, 315.76, -202.80, 61.925, 159.00},
    {12.554, 313.64, -200.58, 61.773, 157.28},
    {12.518, 311.49, -198.32, 61.616, 155.54},
    {12.480, 309.31, -196.04, 61.454, 153.78},
    {12.444, 307.30, -193.79, 61.314, 152.14},
    {12.407, 305.20, -191.50, 61.163, 150.45},
    {12.363, 301.01, -188.41, 60.728, 147.30},
    {12.334, 300.97, -186.83, 60.854, 147.05},
    {12.296, 298.55, -184.37, 60.659, 145.14},
    {12.262, 296.94, -182.16, 60.571, 143.81},
    {12.225, 294.79, -179.75, 60.409, 142.08},
    {12.189, 292.85, -177.39, 60.276, 140.52},
    {12.151, 290.39, -174.84, 60.071, 138.59},
    {12.116, 288.70, -172.53, 59.971, 137.19},
    {12.081, 286.76, -170.12, 59.835, 135.62},
    {12.043, 284.33, -167.53, 59.631, 133.71},
    {12.009, 282.73, -165.19, 59.541, 132.37},
    {11.971, 280.31, -162.59, 59.336, 130.46},
    {11.936, 278.25, -160.09, 59.182, 128.81},
    {11.901, 276.70, -157.72, 59.096, 127.49},
    {11.864, 274.30, -155.09, 58.891, 125.59},
    {11.830, 272.59, -152.65, 58.781, 124.15},
    {11.794, 270.56, -150.12, 58.625, 122.49},
    {11.759, 268.68, -147.61, 58.490, 120.93},
    {11.723, 266.70, -145.08, 58.339, 119.29},
    {11.688, 264.69, -142.53, 58.183, 117.63},
    {11.651, 262.35, -139.91, 57.978, 115.73},
    {11.617, 260.72, -137.45, 57.874, 114.31},
    {11.582, 258.72, -134.90, 57.715, 112.63},
    {11.546, 256.38, -132.30, 57.507, 110.71},
    {11.512, 254.75, -129.84, 57.398, 109.26},
    {11.477, 252.75, -127.32, 57.236, 107.55},
    {11.442, 250.77, -124.81, 57.074, 105.84},
    {11.407, 248.74, -122.30, 56.903, 104.08},
    {11.373, 246.73, -119.81, 56.735, 102.33},
    {11.338, 244.75, -117.35, 56.569, 100.59},
    {11.304, 242.85, -114.92, 56.412, 98.882},
    {11.269, 240.87, -112.50, 56.244, 97.116},
    {11.235, 238.91, -110.10, 56.075, 95.341},
    {11.201, 236.92, -107.74, 55.901, 93.533},
    {11.166, 234.94, -105.40, 55.727, 91.722},
    {11.131, 232.68, -103.08, 55.508, 89.698},
    {11.093, 229.55, -100.74, 55.150, 87.096},
    {11.065, 229.07, -98.619, 55.203, 86.223},
    {11.031, 227.04, -96.442, 55.014, 84.310},
    {10.997, 225.15, -94.314, 54.844, 82.469},
    {10.963, 222.92, -92.240, 54.620, 80.383},
    {10.930, 221.20, -90.217, 54.473, 78.619},
    {10.897, 219.34, -88.251, 54.301, 76.738},
    {10.864, 217.41, -86.350, 54.118, 74.796},
    {10.831, 215.49, -84.516, 53.933, 72.832},
    {10.797, 213.29, -82.778, 53.703, 70.662}
  };

  /* Check pointers */
  CheckPointer(FUNCTION_NAME, "(loc0)", DATA_ARRAY, loc0);
  CheckPointer(FUNCTION_NAME, "(nuc)", DATA_ARRAY, nuc);

  /* Check energy limit */
  if (RDB[DATA_PHOTON_EMAX] > Emax)
    Die(FUNCTION_NAME, "Maximum photon energy (%.2f MeV) above pair production maximum (%.2f MeV)", 
        RDB[DATA_PHOTON_EMAX], Emax);

  Z = RDB[nuc + NUCLIDE_Z]; /* NOTE: Do not type cast! */

  a = FS_CONST*Z;
  a2 = a*a;
  fc = a2*(1.0/(1.0 + a2) + 0.202059 - a2*(0.03693 - a2*(0.00835
      - a2*(0.00201 - a2*(0.00049 - a2*(0.00012 - a2*0.00003))))));

  /* Store fit coefficients for the maximum differential xs */

  ptr = ReallocMem(DATA_ARRAY, 5);
  WDB[loc0 + PHOTON_DIST_PTR_PP_MDXSFC] = (double)ptr;

  for (i = 0; i < 5; i++)
   WDB[ptr++] = ppmaxdxsfitc[(long)Z - 1][i];

  /* Store coefficient coefficient FC */

  WDB[loc0 + PHOTON_DIST_PP_FC] = -4.0*(log(Z)/3.0 + fc);

  /* Store coefficient coefficient array F0 */

  ptr = ReallocMem(DATA_ARRAY, 4);
  WDB[loc0 + PHOTON_DIST_PTR_PP_F0] = (double)ptr;

  WDB[ptr] = -0.1774 - 12.10*a + 11.18*a2;
  WDB[ptr + 1] = 8.523 + 73.26*a - 44.41*a2;
  WDB[ptr + 2] = -13.52 - 121.1*a + 96.41*a2;
  WDB[ptr + 3] = 8.946 + 62.05*a - 63.41*a2;

  /* Store coefficient coefficient G0 */

  WDB[loc0 + PHOTON_DIST_PP_G0] = 136.0/pow(Z, 1.0/3.0);

  /*************************************************************************/

}
